
<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <meta name="description" content="Documentation site for the http4k web framework written in Kotlin">
    
    
    <link rel="canonical" href="http://www.http4k.org/guide/modules/core/">
    
    
    <meta name="author" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">
    
    
    <link rel="shortcut icon" href="../../../assets/images/favicon.png">
    
    <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.3">
    
    
    
    <title>Core - http4k</title>
    
    
    
    <script src="../../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application-acc56dad49.css">
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application-8817cfa535.palette.css">
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
    <style>body, input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
    }

    code, kbd, pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
    }</style>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    <link rel="stylesheet" href="../../.././css/site.css">
    
    
</head>




<body data-md-color-primary="indigo" data-md-color-accent="blue">

<svg class="md-svg">
    <defs>
        
        
        <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
    </defs>
</svg>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>

<header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid">
        <div class="md-flex">
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <a href="http://www.http4k.org" title="http4k" class="md-logo md-header-nav__button">
                    <img src="../../../img/logo_1100x200_white_on_blue_trans.png" height="24">
                </a>
                
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Modules
                </span>
              
            
            Core
          
        </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
                
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
                
            </div>
            
            <div class="md-flex__cell md-flex__cell--shrink">
                <div class="md-header-nav__source">
                    


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

                </div>
            </div>
            
        </div>
    </nav>
</header>

<div class="md-container">
    
    
    <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
            
            
            <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                        <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="drawer">
        
        <i class="md-logo md-nav__button">
            <img src="../../../img/logo_1100x200_white_on_blue_trans.png">
        </i>
        
        http4k
    </label>
    
    <div class="md-nav__source">
        


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../rationale/" title="Rationale & Concepts" class="md-nav__link">
      Rationale & Concepts
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../quickstart/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" checked>
    
    <label class="md-nav__link" for="nav-5-1">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Core
      </label>
    
    <a href="./" title="Core" class="md-nav__link md-nav__link--active">
      Core
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation-gradle" title="Installation (Gradle)" class="md-nav__link">
    Installation (Gradle)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#httphandlers" title="HttpHandlers" class="md-nav__link">
    HttpHandlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-routing" title="Simple Routing" class="md-nav__link">
    Simple Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#typesafe-parameter-destructuringconstruction-of-http-messages-with-lenses" title="Typesafe parameter destructuring/construction of HTTP messages with Lenses" class="md-nav__link">
    Typesafe parameter destructuring/construction of HTTP messages with Lenses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-features" title="Other features" class="md-nav__link">
    Other features
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../servers/" title="Server Backend" class="md-nav__link">
      Server Backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clients/" title="HTTP Client" class="md-nav__link">
      HTTP Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../message_formats/" title="Message Formats" class="md-nav__link">
      Message Formats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templating/" title="Templating" class="md-nav__link">
      Templating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../contracts/" title="Typesafe Contracts" class="md-nav__link">
      Typesafe Contracts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/" title="Application Testing" class="md-nav__link">
      Application Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Worked TDD Example
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Worked TDD Example
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_1_building_a_walking_skeleton/" title="1. Building a walking skeleton" class="md-nav__link">
      1. Building a walking skeleton
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_2_adding_the_first_endpoint/" title="2. Adding an endpoint" class="md-nav__link">
      2. Adding an endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_3_adding_the_second_endpoint/" title="3. Adding another endpoint" class="md-nav__link">
      3. Adding another endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_4_adding_an_external_dependency/" title="4. An external dependency" class="md-nav__link">
      4. An external dependency
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Cookbook
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Cookbook
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/server_as_a_function/" title="Server as a function" class="md-nav__link">
      Server as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/client_as_a_function/" title="Client as a function" class="md-nav__link">
      Client as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/container_integration/" title="Container integration" class="md-nav__link">
      Container integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/simple_routing/" title="Simple routing" class="md-nav__link">
      Simple routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/nestable_routes/" title="Nestable routes" class="md-nav__link">
      Nestable routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/using_json/" title="Using JSON" class="md-nav__link">
      Using JSON
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/using_templates/" title="Using templates" class="md-nav__link">
      Using templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/generating_data_classes_from_json/" title="Generating data classes from JSON" class="md-nav__link">
      Generating data classes from JSON
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/typesafe_http_contracts/" title="Typesafe HTTP contracts" class="md-nav__link">
      Typesafe HTTP contracts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/typesafe_http_requests_with_lenses/" title="Typesafe HTTP requests with lenses" class="md-nav__link">
      Typesafe HTTP requests with lenses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/test_driven_apps/" title="Test driven apps" class="md-nav__link">
      Test driven apps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../in_action/" title="In action" class="md-nav__link">
      In action
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../contributing/" title="Contributers' Guide" class="md-nav__link">
      Contributers' Guide
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../support/" title="Help & Support" class="md-nav__link">
      Help & Support
    </a>
  </li>

        
    </ul>
</nav>
                    </div>
                </div>
            </div>
            
            
            <div class="md-content">
                <article class="md-content__inner md-typeset">
                    
                    
                    <a href="https://github.com/http4k/http4k/edit/master/src/docs/guide/modules/core/index.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                    
                    
                    <h1>Core</h1>
                    
                    <h3 id="installation-gradle">Installation (Gradle)</h3>
<p><code>compile group: "org.http4k", name: "http4k-core", version: "2.3.0"</code></p>
<h3 id="about">About</h3>
<p>The core module has ZERO dependencies and provides the following:</p>
<ul>
<li>Immutable versions of the HTTP spec objects (Request, Response, Cookies etc).</li>
<li>HTTP handler and filter abstractions which models services as simple, composable functions.</li>
<li>Simple routing implementation, plus <code>HttpHandlerServlet</code> to enable plugging into any Servlet engine. </li>
<li><a href="https://www21.in.tum.de/teaching/fp/SS15/papers/17.pdf">Lens</a> mechanism for typesafe destructuring and construction of HTTP messages.</li>
<li>Abstractions for Servers, Clients, messasge formats, Templating etc.</li>
</ul>
<h4 id="httphandlers">HttpHandlers</h4>
<p>In <strong>http4k</strong>, an HTTP service is just a typealias of a simple function:</p>
<div class="codehilite"><pre><span></span><span class="n">typealias</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">(</span><span class="n">Request</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Response</span>
</pre></div>


<p>First described in this Twitter paper <a href="https://monkey.org/~marius/funsrv.pdf">"Your Server as a Function"</a>, this abstraction allows us lots of 
flexibility in a language like Kotlin, since the conceptual barrier to service construction is reduced to effectively nil. Here is the simplest example - note that we don't need any special infrastructure to create an <code>HttpHandler</code>, neither do we 
need to launch a real HTTP container to exercise it:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;Hello, ${request.query(&quot;</span><span class="n">name</span><span class="s">&quot;)}!&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">val</span> <span class="py">get</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">).</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">app</span><span class="p">(</span><span class="k">get</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bodyString</span><span class="p">())</span>
</pre></div>


<p>To mount the <code>HttpHandler</code> in a container, the can simply be converted to a Servlet by calling <code>handler.asServlet()</code></p>
<h3 id="filters">Filters</h3>
<p>Filters add extra processing to either the Request or Response. In <strong>http4k</strong>, they are modelled as:</p>
<div class="codehilite"><pre><span></span><span class="k">interface</span> <span class="nc">Filter</span> <span class="p">:</span> <span class="p">(</span><span class="n">HttpHandler</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">HttpHandler</span>
</pre></div>


<p>Filters are designed to simply compose together (using <code>then()</code>) , creating reusable stacks of behaviour which can then be applied to any <code>HttpHandler</code>. 
For example, to add Basic Auth and latency reporting to a service:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span> <span class="p">}</span>

<span class="k">val</span> <span class="py">myFilter</span> <span class="p">=</span> <span class="n">Filter</span> <span class="p">{</span>
    <span class="n">next</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> 
            <span class="k">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
            <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="k">val</span> <span class="py">latency</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">start</span>
            <span class="n">println</span><span class="p">(</span><span class="s">&quot;I took $latency ms&quot;</span><span class="p">)</span>
            <span class="n">response</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">val</span> <span class="py">latencyAndBasicAuth</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">ServerFilters</span><span class="p">.</span><span class="n">BasicAuth</span><span class="p">(</span><span class="s">&quot;my realm&quot;</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">myFilter</span><span class="p">)</span>
<span class="k">val</span> <span class="py">app</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">latencyAndBasicAuth</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</pre></div>


<p>The <code>http4k-core</code> module comes with a set of handy Filters for application to both Server and Client <code>HttpHandlers</code>, covering common things like:</p>
<ul>
<li>Request tracing headers (x-b3-traceid etc)</li>
<li>Basic Auth</li>
<li>Cache Control</li>
<li>CORS</li>
<li>Cookie handling</li>
<li>Debugging request and responses</li>
</ul>
<p>Check out the <code>org.http4k.filter</code> package for the exact list.</p>
<h3 id="simple-routing">Simple Routing</h3>
<p>Basic routing for mapping a URL pattern to an <code>HttpHandler</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/hello/{name:*}&quot;</span> <span class="n">to</span> <span class="n">GET</span> <span class="n">bind</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;Hello, ${request.path(&quot;</span><span class="n">name</span><span class="s">&quot;)}!&quot;</span><span class="p">)</span> <span class="p">},</span>
    <span class="s">&quot;/fail&quot;</span> <span class="n">to</span> <span class="n">POST</span> <span class="n">bind</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">INTERNAL_SERVER_ERROR</span><span class="p">)</span> <span class="p">}</span>
<span class="p">).</span><span class="n">asServer</span><span class="p">(</span><span class="n">Jetty</span><span class="p">(</span><span class="m">8000</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>
</pre></div>


<p>Note that the <code>http4k-contract</code> module contains a more typesafe implementation of routing functionality.</p>
<h3 id="typesafe-parameter-destructuringconstruction-of-http-messages-with-lenses">Typesafe parameter destructuring/construction of HTTP messages with Lenses</h3>
<p>Getting values from HTTP messages is one thing, but we want to ensure that those values are both present and valid. 
For this purpose, we can use a <a href="https://www21.in.tum.de/teaching/fp/SS15/papers/17.pdf">Lens</a>. A Lens is a bi-directional 
entity which can be used to either get or set a particular value from/onto an HTTP message. <strong>http4k</strong> provides a DSL 
to configure these lenses to target particular parts of the message, whilst at the same time specifying the requirement 
for those parts (i.e. mandatory or optional). Some examples of declarations are:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">pathLocalDate</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">localDate</span><span class="p">().</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">requiredQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myQueryName&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">nonEmptyQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">nonEmptyString</span><span class="p">().</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myNonEmptyQuery&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">optionalHeader</span> <span class="p">=</span> <span class="n">Header</span><span class="p">.</span><span class="n">int</span><span class="p">().</span><span class="n">optional</span><span class="p">(</span><span class="s">&quot;Content-Length&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">responseBody</span> <span class="p">=</span> <span class="n">Body</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">PLAIN_TEXT</span><span class="p">).</span><span class="n">toLens</span><span class="p">()</span>

<span class="c1">// Most of the useful common JDK types are covered. However, if we want to use our own types, we can just use `map()`</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">CustomType</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">val</span> <span class="py">requiredCustomQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">::</span><span class="n">CustomType</span><span class="p">,</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">value</span> <span class="p">}).</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myCustomType&quot;</span><span class="p">)</span>

<span class="c1">//To use the Lens, simply `invoke() or extract()` it using an HTTP message to extract the value, or alternatively `invoke() or inject()` it with the value if we are modifying (via copy) the message:</span>
<span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/hello/{date:*}&quot;</span> <span class="n">to</span> <span class="n">GET</span> <span class="n">bind</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> 
         <span class="k">val</span> <span class="py">pathDate</span><span class="p">:</span> <span class="n">LocalDate</span> <span class="p">=</span> <span class="n">pathLocalDate</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> 
         <span class="c1">// SAME AS: </span>
         <span class="c1">// val pathDate: LocalDate = pathLocalDate.extract(request)</span>

         <span class="k">val</span> <span class="py">customType</span><span class="p">:</span> <span class="n">CustomType</span> <span class="p">=</span> <span class="n">requiredCustomQuery</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
         <span class="k">val</span> <span class="py">anIntHeader</span><span class="p">:</span> <span class="n">Int</span><span class="p">?</span> <span class="p">=</span> <span class="n">optionalHeader</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

         <span class="k">val</span> <span class="py">baseResponse</span> <span class="p">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span>
         <span class="k">val</span> <span class="py">responseWithHeader</span> <span class="p">=</span> <span class="n">optionalHeader</span><span class="p">(</span><span class="n">anIntHeader</span><span class="p">,</span> <span class="n">baseResponse</span><span class="p">)</span>
         <span class="c1">// SAME AS:</span>
         <span class="c1">// val responseWithHeader = optionalHeader.inject(anIntHeader, baseResponse)</span>

         <span class="n">responseBody</span><span class="p">(</span><span class="s">&quot;you sent $pathDate and $customType&quot;</span><span class="p">,</span> <span class="n">responseWithHeader</span><span class="p">)</span> 
      <span class="p">}</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">ServerFilters</span><span class="p">.</span><span class="n">CatchLensFailure</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/hello/2000-01-01?myCustomType=someValue&quot;</span><span class="p">)))</span>
<span class="c1">//With the addition of the `CatchLensFailure` filter, no other validation is required when using Lenses, as **http4k** will handle invalid requests by returning a BAD_REQUEST (400) response.</span>

<span class="c1">//More convieniently for construction of HTTP messages, multiple lenses can be used at once to modify a message, which is useful for properly building both requests and responses in a typesafe way without resorting to string values (especially in </span>
<span class="n">URLs</span> <span class="n">which</span> <span class="n">should</span> <span class="n">never</span> <span class="n">be</span> <span class="n">constructed</span> <span class="n">using</span> <span class="n">String</span> <span class="n">concatenation</span><span class="p">):</span>

<span class="k">val</span> <span class="py">modifiedRequest</span><span class="p">:</span> <span class="n">Request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://google.com/{pathLocalDate}&quot;</span><span class="p">).</span><span class="n">with</span><span class="p">(</span>
    <span class="n">pathLocalDate</span> <span class="n">of</span> <span class="n">LocalDate</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="n">requiredQuery</span> <span class="n">of</span> <span class="s">&quot;myAmazingString&quot;</span><span class="p">,</span>
    <span class="n">optionalHeader</span> <span class="n">of</span> <span class="m">123</span>
<span class="p">)</span>
</pre></div>


<h3 id="other-features">Other features</h3>
<p>Creates <code>curl</code> command for a given request:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">curl</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="s">&quot;http://httpbin.org/post&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;foo&quot;</span> <span class="n">to</span> <span class="s">&quot;bar&quot;</span><span class="p">).</span><span class="n">toBody</span><span class="p">()).</span><span class="n">toCurl</span><span class="p">()</span>
<span class="c1">// curl -X POST --data &quot;foo=bar&quot; &quot;http://httpbin.org/post&quot;</span>
</pre></div>
                    
                    
                    
                    
                    
                    
                    
                </article>
            </div>
        </div>
    </main>
    
    
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../quickstart/" title="Getting started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting started
              </span>
            </div>
          </a>
        
        
          <a href="../servers/" title="Server Backend" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Server Backend
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - David Denton (@daviddenton), IvanSanchez (@s4nchez)
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
    
</div>

<script src="../../../assets/javascripts/application-b30566c560.js"></script>


<script>app.initialize({url: {base: "../../.."}})</script>





</body>
</html>


<!DOCTYPE html>
<html lang="en" class="no-js" itemscope itemtype="http://schema.org/Product">
<head>
    
    <meta charset="utf-8">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <meta name="description" content="Documentation site for the http4k web framework written in Kotlin">
    
    
    <link rel="canonical" href="https://http4k.org/guide/modules/core/">
    
    
    <meta name="author" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">
    
    <!-- ****** faviconit.com favicons ****** -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
    <link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
    <link rel="apple-touch-icon" href="/img/favicon-57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="/img/favicon-144.png">
    <meta name="msapplication-config" content="/img/browserconfig.xml">
    <!-- ****** faviconit.com favicons ****** -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@http4k">
    <meta name="twitter:creator" content="@http4k">
    <meta name="twitter:title" content="http4k web framework">
    <meta name="twitter:description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.">
    <meta name="twitter:image" content="https://www.http4k.org/img/logo_card_blue_on_white.png">
    <meta property="og:title" content="http4k web framework" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://www.http4k.org/" />
    <meta property="og:image" content="https://www.http4k.org/img/logo_card_blue_on_white.png" />
    <meta property="og:description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way." />
    <meta itemprop="name" content="http4k">
    <meta itemprop="description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.">
    <meta itemprop="image" content="https://www.http4k.org/img/logo_card_blue_on_white.png">

    <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.3">
    
    
    
    <title>Core - http4k</title>
    
    
    
    <script src="../../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application-acc56dad49.css">
    
    <link rel="stylesheet" href="../../../assets/stylesheets/application-8817cfa535.palette.css">
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
    <style>body, input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
    }

    code, kbd, pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
    }</style>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    <link rel="stylesheet" href="../../.././css/site.css">
    
    
</head>




<body data-md-color-primary="indigo" data-md-color-accent="blue">

<svg class="md-svg">
    <defs>
        
        
        <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
    </defs>
</svg>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>

<header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid">
        <div class="md-flex">
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <a href="https://http4k.org" title="http4k" class="md-logo md-header-nav__button">
                    <img src="../../../img/logo_1100x200_white_on_blue_trans.png" height="24">
                </a>
                
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Modules
                </span>
              
            
            Core
          
        </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
                
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
                
            </div>
            
            <div class="md-flex__cell md-flex__cell--shrink">
                <div class="md-header-nav__source">
                    


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

                </div>
            </div>
            
        </div>
    </nav>
</header>

<div class="md-container">
    
    
    <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
            
            
            <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                        <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="drawer">
        
        <i class="md-logo md-nav__button">
            <img src="../../../img/logo_1100x200_white_on_blue_trans.png">
        </i>
        
        http4k
    </label>
    
    <div class="md-nav__source">
        


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../rationale/" title="Rationale & Concepts" class="md-nav__link">
      Rationale & Concepts
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../quickstart/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" checked>
    
    <label class="md-nav__link" for="nav-5-1">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Core
      </label>
    
    <a href="./" title="Core" class="md-nav__link md-nav__link--active">
      Core
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation-gradle" title="Installation (Gradle)" class="md-nav__link">
    Installation (Gradle)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#httphandlers" title="HttpHandlers" class="md-nav__link">
    HttpHandlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routers-nestable-path-based-routing" title="Routers - Nestable, path-based Routing" class="md-nav__link">
    Routers - Nestable, path-based Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#typesafe-parameter-destructuringconstruction-of-http-messages-with-lenses" title="Typesafe parameter destructuring/construction of HTTP messages with Lenses" class="md-nav__link">
    Typesafe parameter destructuring/construction of HTTP messages with Lenses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serving-static-assets" title="Serving static assets" class="md-nav__link">
    Serving static assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-and-response-tostring" title="Request and Response toString()" class="md-nav__link">
    Request and Response toString()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#curl-format" title="CURL format" class="md-nav__link">
    CURL format
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../servers/" title="Server Backend" class="md-nav__link">
      Server Backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clients/" title="HTTP Client" class="md-nav__link">
      HTTP Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../message_formats/" title="Message Formats" class="md-nav__link">
      Message Formats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templating/" title="Templating" class="md-nav__link">
      Templating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../contracts/" title="Typesafe Contracts" class="md-nav__link">
      Typesafe Contracts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws/" title="AWS" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hamkrest/" title="Hamkrest" class="md-nav__link">
      Hamkrest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../webdriver/" title="WebDriver" class="md-nav__link">
      WebDriver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/" title="Application Testing" class="md-nav__link">
      Application Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Worked TDD Example
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Worked TDD Example
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_1_building_a_walking_skeleton/" title="1. Building a walking skeleton" class="md-nav__link">
      1. Building a walking skeleton
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_2_adding_the_first_endpoint/" title="2. Adding an endpoint" class="md-nav__link">
      2. Adding an endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_3_adding_the_second_endpoint/" title="3. Adding another endpoint" class="md-nav__link">
      3. Adding another endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example/_4_adding_an_external_dependency/" title="4. An external dependency" class="md-nav__link">
      4. An external dependency
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Cookbook
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Cookbook
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/server_as_a_function/" title="Server as a function" class="md-nav__link">
      Server as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/client_as_a_function/" title="Client as a function" class="md-nav__link">
      Client as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/container_integration/" title="Container integration" class="md-nav__link">
      Container integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/simple_routing/" title="Simple routing" class="md-nav__link">
      Simple routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/nestable_routes/" title="Nestable routes" class="md-nav__link">
      Nestable routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/using_json/" title="Using JSON" class="md-nav__link">
      Using JSON
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/using_templates/" title="Using templates" class="md-nav__link">
      Using templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/generating_data_classes_from_json/" title="Generating data classes from JSON" class="md-nav__link">
      Generating data classes from JSON
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/typesafe_http_contracts/" title="Typesafe HTTP contracts" class="md-nav__link">
      Typesafe HTTP contracts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/typesafe_http_requests_with_lenses/" title="Typesafe HTTP requests with lenses" class="md-nav__link">
      Typesafe HTTP requests with lenses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cookbook/test_driven_apps/" title="Test driven apps" class="md-nav__link">
      Test driven apps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../in_action/" title="In action" class="md-nav__link">
      In action
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../contributing/" title="Contributers' Guide" class="md-nav__link">
      Contributers' Guide
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../../support/" title="Help & Support" class="md-nav__link">
      Help & Support
    </a>
  </li>

        
    </ul>
</nav>
                    </div>
                </div>
            </div>
            
            
            <div class="md-content">
                <article class="md-content__inner md-typeset">
                    
                    
                    <a href="https://github.com/http4k/http4k/edit/master/src/docs/guide/modules/core/index.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                    
                    
                    <h1>Core</h1>
                    
                    <h3 id="installation-gradle">Installation (Gradle)</h3>
<p><code>compile group: "org.http4k", name: "http4k-core", version: "2.25.4"</code></p>
<h3 id="about">About</h3>
<p>Apart from Kotlin StdLib, the core module has ZERO dependencies and provides the following:</p>
<ul>
<li>Immutable versions of the HTTP spec objects (Request, Response, Cookies etc).</li>
<li>HTTP handler and filter abstractions which models services as simple, composable functions.</li>
<li>Simple routing implementation, plus <code>HttpHandlerServlet</code> to enable plugging into any Servlet engine. </li>
<li><a href="https://www21.in.tum.de/teaching/fp/SS15/papers/17.pdf">Lens</a> mechanism for typesafe destructuring and construction of HTTP messages.</li>
<li>Abstractions for Servers, Clients, JSON Message formats, Templating etc.</li>
<li><code>SunHttp</code> Single-LOC development Server-backend</li>
<li>Static file-serving capability with <strong>Caching</strong> and <strong>Hot-Reload</strong></li>
</ul>
<h4 id="httphandlers">HttpHandlers</h4>
<p>In <strong>http4k</strong>, an HTTP service is just a typealias of a simple function:</p>
<div class="codehilite"><pre><span></span><span class="n">typealias</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">(</span><span class="n">Request</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Response</span>
</pre></div>


<p>First described in this Twitter paper <a href="https://monkey.org/~marius/funsrv.pdf">"Your Server as a Function"</a>, this abstraction allows us lots of 
flexibility in a language like Kotlin, since the conceptual barrier to service construction is reduced to effectively nil. Here is the simplest example - note that we don't need any special infrastructure to create an <code>HttpHandler</code>, neither do we 
need to launch a real HTTP container to exercise it:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;Hello, ${request.query(&quot;</span><span class="n">name</span><span class="s">&quot;)}!&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">val</span> <span class="py">get</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">).</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">app</span><span class="p">(</span><span class="k">get</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bodyString</span><span class="p">())</span>
</pre></div>


<p>To mount the <code>HttpHandler</code> in a container, the can simply be converted to a Servlet by calling <code>handler.asServlet()</code></p>
<h3 id="filters">Filters</h3>
<p>Filters add extra processing to either the Request or Response. In <strong>http4k</strong>, they are modelled as:</p>
<div class="codehilite"><pre><span></span><span class="k">interface</span> <span class="nc">Filter</span> <span class="p">:</span> <span class="p">(</span><span class="n">HttpHandler</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">HttpHandler</span>
</pre></div>


<p>Filters are designed to simply compose together (using <code>then()</code>) , creating reusable stacks of behaviour which can then be applied to any <code>HttpHandler</code>. 
For example, to add Basic Auth and latency reporting to a service:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span> <span class="p">}</span>

<span class="k">val</span> <span class="py">myFilter</span> <span class="p">=</span> <span class="n">Filter</span> <span class="p">{</span>
    <span class="n">next</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> 
            <span class="k">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
            <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="k">val</span> <span class="py">latency</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">start</span>
            <span class="n">println</span><span class="p">(</span><span class="s">&quot;I took $latency ms&quot;</span><span class="p">)</span>
            <span class="n">response</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">val</span> <span class="py">latencyAndBasicAuth</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">ServerFilters</span><span class="p">.</span><span class="n">BasicAuth</span><span class="p">(</span><span class="s">&quot;my realm&quot;</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">myFilter</span><span class="p">)</span>
<span class="k">val</span> <span class="py">app</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">latencyAndBasicAuth</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</pre></div>


<p>The <code>http4k-core</code> module comes with a set of handy Filters for application to both Server and Client <code>HttpHandlers</code>, covering common things like:</p>
<ul>
<li>Request tracing headers (x-b3-traceid etc)</li>
<li>Basic Auth</li>
<li>Cache Control</li>
<li>CORS</li>
<li>Cookie handling</li>
<li>Debugging request and responses</li>
</ul>
<p>Check out the <code>org.http4k.filter</code> package for the exact list.</p>
<h3 id="routers-nestable-path-based-routing">Routers - Nestable, path-based Routing</h3>
<p>Create a Router using routes() to bind a static or dynamic path to either an HttpHandler, or to another sub-Router. These Routers can be nested infinitely deep and <strong>http4k</strong> will search for a matching route using a depth-first search algorithm, before falling back finally to a 404:</p>
<div class="codehilite"><pre><span></span><span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/hello&quot;</span> <span class="n">bind</span> <span class="n">routes</span><span class="p">(</span>
        <span class="s">&quot;/{name:*}&quot;</span> <span class="n">bind</span> <span class="n">GET</span> <span class="n">to</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;Hello, ${request.path(&quot;</span><span class="n">name</span><span class="s">&quot;)}!&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">),</span>
    <span class="s">&quot;/fail&quot;</span> <span class="n">bind</span> <span class="n">POST</span> <span class="n">to</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">INTERNAL_SERVER_ERROR</span><span class="p">)</span> <span class="p">}</span>
<span class="p">).</span><span class="n">asServer</span><span class="p">(</span><span class="n">Jetty</span><span class="p">(</span><span class="m">8000</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>
</pre></div>


<p>Note that the <code>http4k-contract</code> module contains a more typesafe implementation of routing functionality, with runtime-generated live documentation in Swagger format.</p>
<h3 id="typesafe-parameter-destructuringconstruction-of-http-messages-with-lenses">Typesafe parameter destructuring/construction of HTTP messages with Lenses</h3>
<p>Getting values from HTTP messages is one thing, but we want to ensure that those values are both present and valid. 
For this purpose, we can use a <a href="https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/basic-lensing">Lens</a>. </p>
<p>A Lens is a bi-directional entity which can be used to either <strong>get</strong> or <strong>set</strong> a particular value from/onto an HTTP message. <strong>http4k</strong> provides a DSL 
to configure these lenses to target particular parts of the message, whilst at the same time specifying the requirement for those parts (i.e. mandatory or optional). </p>
<p>To utilise a lens, first you have to declare it with the form <code>&lt;Location&gt;.&lt;configuration and mapping operations&gt;.&lt;terminator&gt;</code>.</p>
<p>There is one "location" type for each part of the message, each with config/mapping operations which are specific to that location:</p>
<table>
<thead>
<tr>
<th>Location</th>
<th>Starting type</th>
<th>Applicable to</th>
<th>Multiplicity</th>
<th>Requirement terminator</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td>Query</td>
<td><code>String</code></td>
<td><code>Request</code></td>
<td>Singular or multiple</td>
<td>Optional or Required</td>
<td><code>Query.optional("name")</code><br/><code>Query.required("name")</code><br/><code>Query.int().required("name")</code><br/><code>Query.localDate().multi.required("name")</code><br/><code>Query.map(::CustomType, { it.value }).required("name")</code></td>
</tr>
<tr>
<td>Header</td>
<td><code>String</code></td>
<td><code>Request</code> or <code>Response</code></td>
<td>Singular or multiple</td>
<td>Optional or Required</td>
<td><code>Header.optional("name")</code><br/><code>Header.required("name")</code><br/><code>Header.int().required("name")</code><br/><code>Header.localDate().multi.required("name")</code><br/><code>Header.map(::CustomType, { it.value }).required("name")</code></td>
</tr>
<tr>
<td>Path</td>
<td><code>String</code></td>
<td><code>Request</code></td>
<td>Singular</td>
<td>Required</td>
<td><code>Path.of("name")</code><br/><code>Path.int().of("name")</code><br/><code>Path.map(::CustomType, { it.value }).of("name")</code></td>
</tr>
<tr>
<td>FormField</td>
<td><code>String</code></td>
<td><code>WebForm</code></td>
<td>Singular or multiple</td>
<td>Optional or Required</td>
<td><code>FormField.optional("name")</code><br/><code>FormField.required("name")</code><br/><code>FormField.int().required("name")</code><br/><code>FormField.localDate().multi.required("name")</code><br/><code>FormField.map(::CustomType, { it.value }).required("name")</code></td>
</tr>
<tr>
<td>Body</td>
<td><code>ByteBuffer</code></td>
<td><code>Request</code> or <code>Response</code></td>
<td>Singular</td>
<td>Required</td>
<td><code>Body.string(ContentType.TEXT_PLAIN).toLens()</code><br/><code>Body.json().toLens()</code><br/><code>Body.webForm(FormValidator.Strict, FormField.required("name")).toLens()</code></td>
</tr>
</tbody>
</table>
<p>Once the lens is declared, you can use it on a target object to either get or set the value:</p>
<ul>
<li>Retrieving a value: use <code>&lt;lens&gt;.extract(&lt;target&gt;)</code>, or the more concise invoke form: <code>&lt;lens&gt;(&lt;target&gt;)</code></li>
<li>Setting a value: use <code>&lt;lens&gt;.inject(&lt;value&gt;, &lt;target&gt;)</code>, or the more concise invoke form: <code>&lt;lens&gt;(&lt;value&gt;, &lt;target&gt;)</code></li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">pathLocalDate</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">localDate</span><span class="p">().</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">requiredQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myQueryName&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">nonEmptyQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">nonEmptyString</span><span class="p">().</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myNonEmptyQuery&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">optionalHeader</span> <span class="p">=</span> <span class="n">Header</span><span class="p">.</span><span class="n">int</span><span class="p">().</span><span class="n">optional</span><span class="p">(</span><span class="s">&quot;Content-Length&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">responseBody</span> <span class="p">=</span> <span class="n">Body</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">PLAIN_TEXT</span><span class="p">).</span><span class="n">toLens</span><span class="p">()</span>

<span class="c1">// Most of the useful common JDK types are covered. However, if we want to use our own types, we can just use `map()`</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">CustomType</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">val</span> <span class="py">requiredCustomQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">::</span><span class="n">CustomType</span><span class="p">,</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">value</span> <span class="p">}).</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;myCustomType&quot;</span><span class="p">)</span>

<span class="c1">//To use the Lens, simply `invoke() or extract()` it using an HTTP message to extract the value, or alternatively `invoke() or inject()` it with the value if we are modifying (via copy) the message:</span>
<span class="k">val</span> <span class="py">handler</span> <span class="p">=</span> <span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/hello/{date:*}&quot;</span> <span class="n">bind</span> <span class="n">GET</span> <span class="n">to</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> 
         <span class="k">val</span> <span class="py">pathDate</span><span class="p">:</span> <span class="n">LocalDate</span> <span class="p">=</span> <span class="n">pathLocalDate</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> 
         <span class="c1">// SAME AS: </span>
         <span class="c1">// val pathDate: LocalDate = pathLocalDate.extract(request)</span>

         <span class="k">val</span> <span class="py">customType</span><span class="p">:</span> <span class="n">CustomType</span> <span class="p">=</span> <span class="n">requiredCustomQuery</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
         <span class="k">val</span> <span class="py">anIntHeader</span><span class="p">:</span> <span class="n">Int</span><span class="p">?</span> <span class="p">=</span> <span class="n">optionalHeader</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

         <span class="k">val</span> <span class="py">baseResponse</span> <span class="p">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span>
         <span class="k">val</span> <span class="py">responseWithHeader</span> <span class="p">=</span> <span class="n">optionalHeader</span><span class="p">(</span><span class="n">anIntHeader</span><span class="p">,</span> <span class="n">baseResponse</span><span class="p">)</span>
         <span class="c1">// SAME AS:</span>
         <span class="c1">// val responseWithHeader = optionalHeader.inject(anIntHeader, baseResponse)</span>

         <span class="n">responseBody</span><span class="p">(</span><span class="s">&quot;you sent $pathDate and $customType&quot;</span><span class="p">,</span> <span class="n">responseWithHeader</span><span class="p">)</span> 
      <span class="p">}</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">ServerFilters</span><span class="p">.</span><span class="n">CatchLensFailure</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/hello/2000-01-01?myCustomType=someValue&quot;</span><span class="p">)))</span>
<span class="c1">//With the addition of the `CatchLensFailure` filter, no other validation is required when using Lenses, as **http4k** will handle invalid requests by returning a BAD_REQUEST (400) response.</span>

<span class="c1">//More convieniently for construction of HTTP messages, multiple lenses can be used at once to modify a message, which is useful for properly building both requests and responses in a typesafe way without resorting to string values (especially in </span>
<span class="n">URLs</span> <span class="n">which</span> <span class="n">should</span> <span class="n">never</span> <span class="n">be</span> <span class="n">constructed</span> <span class="n">using</span> <span class="n">String</span> <span class="n">concatenation</span><span class="p">):</span>

<span class="k">val</span> <span class="py">modifiedRequest</span><span class="p">:</span> <span class="n">Request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://google.com/{pathLocalDate}&quot;</span><span class="p">).</span><span class="n">with</span><span class="p">(</span>
    <span class="n">pathLocalDate</span> <span class="n">of</span> <span class="n">LocalDate</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="n">requiredQuery</span> <span class="n">of</span> <span class="s">&quot;myAmazingString&quot;</span><span class="p">,</span>
    <span class="n">optionalHeader</span> <span class="n">of</span> <span class="m">123</span>
<span class="p">)</span>
</pre></div>


<h3 id="serving-static-assets">Serving static assets</h3>
<p>For serving static assets, just bind a path to a Static block as below, using either a Classpath or HotReload based ResourceLoader instance. Typically, HotReload is used during development and the Classpath strategy is used to serve assets in production from an UberJar. This is usually based on a "devmode" flag when constructing your app":</p>
<div class="codehilite"><pre><span></span><span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/static&quot;</span> <span class="n">bind</span> <span class="n">static</span><span class="p">(</span><span class="n">Classpath</span><span class="p">(</span><span class="s">&quot;org.http4k.some.package.name&quot;</span><span class="p">))</span>
    <span class="s">&quot;/hotreload&quot;</span> <span class="n">bind</span> <span class="n">static</span><span class="p">(</span><span class="n">HotReload</span><span class="p">(</span><span class="s">&quot;path/to/static/dir/goes/here&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>


<h3 id="request-and-response-tostring">Request and Response toString()</h3>
<p>The HttpMessages used by <strong>http4k</strong> toString in the HTTP wire format, which it simple to capture and replay HTTP message streams later in a similar way to tools like <a href="http://www.mbtest.org/">Mountebank</a>.</p>
<h3 id="curl-format">CURL format</h3>
<p>Creates <code>curl</code> command for a given request - this is useful to include in audit logs so exact requests can be replayed if required:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">curl</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="s">&quot;http://httpbin.org/post&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="s">&quot;foo&quot;</span> <span class="n">to</span> <span class="s">&quot;bar&quot;</span><span class="p">).</span><span class="n">toBody</span><span class="p">()).</span><span class="n">toCurl</span><span class="p">()</span>
<span class="c1">// curl -X POST --data &quot;foo=bar&quot; &quot;http://httpbin.org/post&quot;</span>
</pre></div>
                    
                    
                    
                    
                    
                    
                    
                </article>
            </div>
        </div>
    </main>
    
    
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../quickstart/" title="Getting started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting started
              </span>
            </div>
          </a>
        
        
          <a href="../servers/" title="Server Backend" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Server Backend
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - David Denton (@daviddenton), IvanSanchez (@s4nchez)
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
    
</div>

<script src="../../../assets/javascripts/application-b30566c560.js"></script>


<script>app.initialize({url: {base: "../../.."}})</script>




<script>!function (e, t, a, n, o, c, i) {e.GoogleAnalyticsObject = o, e[o] = e[o] || function () {(e[o].q = e[o].q || []).push(arguments)}, e[o].l = 1 * new Date, c = t.createElement(a), i = t.getElementsByTagName(a)[0], c.async = 1, c.src = n, i.parentNode.insertBefore(c, i)}(window, document, "script", "https://www.google-analytics.com/analytics.js", "ga"), ga("create", "UA-69281315-11", "http4k.org"), ga("set", "anonymizeIp", !0), ga("send", "pageview");
var links = document.getElementsByTagName("a");
Array.prototype.map.call(links, function (e) {
    e.host != document.location.host && e.addEventListener("click", function () {
        var t = e.getAttribute("data-md-action") || "follow";
        ga("send", "event", "outbound", t, e.href)
    })
});
var query = document.forms.search.query;
query.addEventListener("blur", function () {
    if (this.value) {
        var e = document.location.pathname;
        ga("send", "pageview", e + "?q=" + this.value)
    }
})</script>


</body>
</html>

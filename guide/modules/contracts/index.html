



<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    
    <meta charset="utf-8">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge">


<meta itemprop="name" content="http4k Contract Module">
<meta name="twitter:title" content="http4k Contract Module">
<meta property="og:title" content="http4k Contract Module" />



<meta name="description" content="Feature overview of the http4k-contract module">
<meta property="og:description" content="Feature overview of the http4k-contract module" />
<meta name="twitter:description" content="Feature overview of the http4k-contract module">



<link rel="canonical" href="https://www.http4k.org/guide/modules/contracts/">



<meta name="author" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">
<meta name="twitter:creator" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">




<meta name="lang:clipboard.copy" content="en">

<meta name="lang:clipboard.copied" content="en">

<meta name="lang:search.language" content="en">

<meta name="lang:search.pipeline.stopwords" content="en">

<meta name="lang:search.pipeline.trimmer" content="en">

<meta name="lang:search.result.none" content="en">

<meta name="lang:search.result.one" content="en">

<meta name="lang:search.result.other" content="en">

<meta name="lang:search.tokenizer" content="en">

<!-- ****** faviconit.com favicons ****** -->
<link rel="shortcut icon" href="/img/favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
<link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<link rel="apple-touch-icon" href="/img/favicon-57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/img/favicon-144.png">
<meta name="msapplication-config" content="/img/browserconfig.xml">
<!-- ****** faviconit.com favicons ****** -->
<meta name="generator" content="mkdocs-1.1.2, mkdocs-material-3.0.4">
    
    
    
    <title>http4k Contract Module</title>
    
    
    
    
    
    
    <meta name="theme-color" content="#3f51b5">
    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/codehilite.css"/>
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&amp;display=swap" rel="stylesheet"/>
    
    
    <link rel="stylesheet" href="/css/main.css"/>
    
    <link rel="stylesheet" href="../../../css/site.css">
    
    
</head>



<body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="blue">







<div class="intro">
    <div class="row no-gutters justify-content-center">
        <div class="aside col-auto">
    <img class="mb-3 sideToggle d-inline-block d-md-none" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
    <a href="/"><div class="logo"><img src="/img/logo-intro.png" width="185" alt="logo" srcset=""/></div></a>
    <ul class="nav flex-column">
        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../documentation/"
               title="Introduction">Introduction</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../rationale/"
               title="Rationale & Concepts">Rationale & Concepts</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../installation/"
               title="Installation">Installation</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../quickstart/"
               title="Getting started">Getting started</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown active show">
            <a class="nav-link dropdown-toggle active"
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="true">Developer Guide</a>
            <div class="dropdown-menu show">
            
            
            
    
        <a class="dropdown-item nav-link dropdown-toggle  active"
            data-toggle="dropdown"
            href="#"
            role="button"
            aria-haspopup="true"
            aria-expanded="true"> Modules</a>
        <div class="dropdown-menu show">
            
            
            
    
        <a class="dropdown-item "
           href="../"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../aws/"
           title="AWS">AWS</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../core/"
           title="Core">Core</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../json/"
           title="JSON handling">JSON handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../clients/"
           title="HTTP & Websocket clients">HTTP & Websocket clients</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../metrics/"
           title="Metrics">Metrics</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../multipart/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../resilience/"
           title="Resilience">Resilience</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../servers/"
           title="Server backend">Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../serverless/"
           title="Serverless backend">Serverless backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../templating/"
           title="Templating">Templating</a>
    

            
            
            
    
        <a class="dropdown-item active"
           href="./"
           title="Typesafe contracts (OpenAPI3)">Typesafe contracts (OpenAPI3)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../oauth/"
           title="OAuth">OAuth</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../cloud_native/"
           title="Cloud native Configuration">Cloud native Configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../jsonrpc/"
           title="JSON RPC">JSON RPC</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../xml/"
           title="XML handling">XML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../yaml/"
           title="YAML handling">YAML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../hamkrest/"
           title="Hamkrest">Hamkrest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../approvaltests/"
           title="Approval Testing">Approval Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../webdriver/"
           title="WebDriver">WebDriver</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../chaos/"
           title="Chaos Testing">Chaos Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../servicevirtualisation/"
           title="Service Virtualisaion">Service Virtualisaion</a>
    

            
        </div>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../testing/"
           title="Application Testing">Application Testing</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Tutorials</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../../tutorials/tdding_http4k/"
           title="TDDing http4k">TDDing http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../tutorials/documenting_apis_with_openapi/"
           title="Documenting http4k apps with OpenApi3">Documenting http4k apps with OpenApi3</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Cookbook</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/"
           title="How to use this guide">How to use this guide</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/server_as_a_function/"
           title="Server as a function">Server as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/client_as_a_function/"
           title="Client as a function">Client as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/container_integration/"
           title="Container integration">Container integration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/simple_routing/"
           title="Simple routing">Simple routing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/service_virtualisation/"
           title="Service Virtualisation with Servirtium">Service Virtualisation with Servirtium</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/nestable_routes/"
           title="Nestable routes">Nestable routes</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/using_templates/"
           title="Templating engines">Templating engines</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/request_context/"
           title="Typesafe RequestContexts">Typesafe RequestContexts</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/typesafe_http_requests_with_lenses/"
           title="Typesafe HTTP requests with lenses">Typesafe HTTP requests with lenses</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/custom_json_marshallers/"
           title="Custom JSON marshallers">Custom JSON marshallers</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/html_forms/"
           title="HTML forms">HTML forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/multipart_forms/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/generating_data_classes/"
           title="Generating data classes for messages">Generating data classes for messages</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/websockets/"
           title="Websockets">Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/typesafe_http_contracts/"
           title="Typesafe HTTP contracts">Typesafe HTTP contracts</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/structured_logging_with_events/"
           title="Structured Logging with Events">Structured Logging with Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/basic_oauth_authorization_server/"
           title="Basic OAuth Server configuration">Basic OAuth Server configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/custom_oauth_provider/"
           title="Custom OAuth Provider configuration">Custom OAuth Provider configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/customised_servers/"
           title="Custom Server (SSL)">Custom Server (SSL)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/principal_lookup/"
           title="Principal lookup">Principal lookup</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/monitoring/"
           title="Monitoring http4k">Monitoring http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/record_and_replay/"
           title="Recording/replaying HTTP traffic">Recording/replaying HTTP traffic</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/test_driven_apps/"
           title="Test driven apps">Test driven apps</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../cookbook/nanoservices/"
           title="Nanoservices">Nanoservices</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../performance/"
               title="Performance">Performance</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../in_action/"
               title="In action">In action</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Blog</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/meet_http4k/"
           title="Meet http4k">Meet http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/typesafe_websockets/"
           title="Typesafe Websockets">Typesafe Websockets</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../support/"
               title="Getting Support">Getting Support</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../contributing/"
               title="Contribute/Support http4k">Contribute/Support http4k</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../code-of-conduct/"
               title="Code of Conduct">Code of Conduct</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../api/"
               title="API docs">API docs</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../changelog/"
               title="Changelog">Changelog</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../faq/"
               title="FAQ">FAQ</a>
        </li>
    

        
    </ul>
</div>
        <main class="col">
            <div class="container">
                <div class="content">
                    <img class="mb-3 sideToggle" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
                    
                    
                    <h1>Typesafe contracts (OpenAPI3)</h1>
                    
                    <h3 id="installation-gradle">Installation (Gradle)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">compile</span> <span class="nl">group:</span> <span class="s2">&quot;org.http4k&quot;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s2">&quot;http4k-contract&quot;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s2">&quot;3.256.1&quot;</span>
<span class="n">compile</span> <span class="nl">group:</span> <span class="s2">&quot;org.http4k&quot;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s2">&quot;http4k-format-&lt;insert json lib&gt;&quot;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s2">&quot;3.256.1&quot;</span>
</code></pre></div>


<h3 id="about">About</h3>
<p>The <code>http4k-contract</code> module adds a much more sophisticated routing mechanism to that available in <code>http4k-core</code>. It adds the facility 
to declare server-side <code>Routes</code> in a completely typesafe way, leveraging the Lens functionality from the core. These <code>Routes</code> are combined into <code>Contracts</code>, which have the following features:</p>
<ul>
<li><strong>Auto-validating</strong> - the <code>Route</code> contract is automatically validated on each call for required-fields and type conversions, removing the requirement  for any validation code to be written by the API user. Invalid calls result in a <code>HTTP 400 (BAD_REQUEST)</code> response.     </li>
<li><strong>Self-describing:</strong> - a generated endpoint is provided which describes all of the <code>Routes</code> in that module. Implementations include <a href="http://swagger.io/">OpenApi v2 &amp; v3/Swagger</a> documentation, including generation of <a href="http://json-schema.org/">JSON schema</a>. These documents can then be used to generate HTTP client and server code in various languages using the <a href="https://openapi-generator.tech/">OpenAPI generator</a>.
 models for messages.</li>
<li><strong>Security:</strong> to secure the <code>Routes</code> against unauthorised access. Current implementations include <code>ApiKey</code>, <code>BasicAuth</code>, <code>BearerAuth</code> and <code>OAuth</code>.</li>
</ul>
<h4 id="code">Code <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/modules/contracts/example.kt"><img class="octocat"/></a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">guide</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">contracts</span>

<span class="o">//</span> <span class="k">for</span> <span class="n">this</span> <span class="n">example</span> <span class="n">we</span><span class="s1">&#39;re using Jackson - note that the auto method imported is an extension</span>
<span class="o">//</span> <span class="n">function</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">defined</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Jackson</span> <span class="n">instance</span>

<span class="kn">import</span> <span class="nn">org.http4k.contract.ContractRoute</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.bind</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.contract</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.div</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.meta</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.openapi.ApiInfo</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.openapi.v3.OpenApi3</span>
<span class="kn">import</span> <span class="nn">org.http4k.contract.security.ApiKeySecurity</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Body</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.ContentType.Companion.TEXT_PLAIN</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.HttpHandler</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Method.POST</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Response</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.Status.Companion.OK</span>
<span class="kn">import</span> <span class="nn">org.http4k.core.with</span>
<span class="kn">import</span> <span class="nn">org.http4k.format.Jackson</span>
<span class="kn">import</span> <span class="nn">org.http4k.format.Jackson.auto</span>
<span class="kn">import</span> <span class="nn">org.http4k.lens.Path</span>
<span class="kn">import</span> <span class="nn">org.http4k.lens.Query</span>
<span class="kn">import</span> <span class="nn">org.http4k.lens.int</span>
<span class="kn">import</span> <span class="nn">org.http4k.lens.string</span>
<span class="kn">import</span> <span class="nn">org.http4k.routing.routes</span>

<span class="o">//</span> <span class="n">this</span> <span class="n">route</span> <span class="n">has</span> <span class="n">a</span> <span class="n">dynamic</span> <span class="n">path</span> <span class="n">segment</span>
<span class="n">fun</span> <span class="n">greetRoute</span><span class="p">():</span> <span class="n">ContractRoute</span> <span class="p">{</span>

    <span class="o">//</span> <span class="n">these</span> <span class="n">lenses</span> <span class="n">define</span> <span class="n">the</span> <span class="n">dynamic</span> <span class="n">parts</span> <span class="n">of</span> <span class="n">the</span> <span class="n">request</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">processing</span>
    <span class="n">val</span> <span class="n">ageQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">required</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">stringBody</span> <span class="o">=</span> <span class="n">Body</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">TEXT_PLAIN</span><span class="p">)</span><span class="o">.</span><span class="n">toLens</span><span class="p">()</span>

    <span class="o">//</span> <span class="n">this</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">route</span> <span class="n">contract</span><span class="p">,</span> <span class="k">with</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">contract</span> <span class="n">of</span> <span class="n">path</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">queries</span> <span class="ow">and</span> <span class="n">body</span> <span class="n">parameters</span><span class="o">.</span>
    <span class="n">val</span> <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;/greet&quot;</span> <span class="o">/</span> <span class="n">Path</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="n">meta</span> <span class="p">{</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot;tells the user hello!&quot;</span>
        <span class="n">queries</span> <span class="o">+=</span> <span class="n">ageQuery</span>
        <span class="n">receiving</span><span class="p">(</span><span class="n">stringBody</span><span class="p">)</span>
    <span class="p">}</span> <span class="n">bindContract</span> <span class="n">GET</span>

    <span class="o">//</span> <span class="n">the</span> <span class="n">this</span> <span class="n">function</span> <span class="n">will</span> <span class="n">dynamically</span> <span class="n">supply</span> <span class="n">a</span> <span class="n">new</span> <span class="n">HttpHandler</span> <span class="k">for</span> <span class="n">each</span> <span class="n">call</span><span class="o">.</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">parameters</span>
    <span class="o">//</span> <span class="n">matches</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">dynamic</span> <span class="n">sections</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">path</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fun</span> <span class="n">greet</span><span class="p">(</span><span class="n">nameFromPath</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">-&gt;</span>
        <span class="n">val</span> <span class="n">age</span> <span class="o">=</span> <span class="n">ageQuery</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">val</span> <span class="n">sentMessage</span> <span class="o">=</span> <span class="n">stringBody</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span><span class="o">.</span><span class="k">with</span><span class="p">(</span><span class="n">stringBody</span> <span class="n">of</span> <span class="s2">&quot;hello $nameFromPath you are $age. You sent $sentMessage&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">spec</span> <span class="n">to</span> <span class="p">::</span><span class="n">greet</span>
<span class="p">}</span>

<span class="n">data</span> <span class="k">class</span> <span class="nc">NameAndMessage</span><span class="p">(</span><span class="n">val</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">val</span> <span class="n">message</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>

<span class="o">//</span> <span class="n">this</span> <span class="n">route</span> <span class="n">uses</span> <span class="n">auto</span><span class="o">-</span><span class="n">marshalling</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">the</span> <span class="n">JSON</span> <span class="n">body</span> <span class="n">directly</span> <span class="n">to</span><span class="o">/</span><span class="kn">from</span> <span class="nn">a</span> <span class="nn">data</span> <span class="nn">class</span> <span class="nn">instance</span>
<span class="n">fun</span> <span class="n">echoRoute</span><span class="p">():</span> <span class="n">ContractRoute</span> <span class="p">{</span>

    <span class="o">//</span> <span class="n">the</span> <span class="n">body</span> <span class="n">lens</span> <span class="n">here</span> <span class="ow">is</span> <span class="n">imported</span> <span class="k">as</span> <span class="n">an</span> <span class="n">extension</span> <span class="n">function</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">Jackson</span> <span class="nn">instance</span>
    <span class="n">val</span> <span class="n">body</span> <span class="o">=</span> <span class="n">Body</span><span class="o">.</span><span class="n">auto</span><span class="o">&lt;</span><span class="n">NameAndMessage</span><span class="o">&gt;</span><span class="p">()</span><span class="o">.</span><span class="n">toLens</span><span class="p">()</span>

    <span class="o">//</span> <span class="n">this</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">route</span> <span class="n">contract</span><span class="p">,</span> <span class="n">including</span> <span class="n">examples</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">input</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">body</span> <span class="n">objects</span> <span class="o">-</span> <span class="n">they</span> <span class="n">will</span>
    <span class="o">//</span> <span class="n">get</span> <span class="n">exploded</span> <span class="n">into</span> <span class="n">JSON</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">OpenAPI</span> <span class="n">docs</span>
    <span class="n">val</span> <span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;/echo&quot;</span> <span class="n">meta</span> <span class="p">{</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot;echoes the name and message sent to it&quot;</span>
        <span class="n">receiving</span><span class="p">(</span><span class="n">body</span> <span class="n">to</span> <span class="n">NameAndMessage</span><span class="p">(</span><span class="s2">&quot;jim&quot;</span><span class="p">,</span> <span class="s2">&quot;hello!&quot;</span><span class="p">))</span>
        <span class="n">returning</span><span class="p">(</span><span class="n">OK</span><span class="p">,</span> <span class="n">body</span> <span class="n">to</span> <span class="n">NameAndMessage</span><span class="p">(</span><span class="s2">&quot;jim&quot;</span><span class="p">,</span> <span class="s2">&quot;hello!&quot;</span><span class="p">))</span>
    <span class="p">}</span> <span class="n">bindContract</span> <span class="n">POST</span>

    <span class="o">//</span> <span class="n">note</span> <span class="n">that</span> <span class="n">because</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t have any dynamic parameters, we can use a HttpHandler instance instead of a function</span>
    <span class="n">val</span> <span class="n">echo</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">-&gt;</span>
        <span class="n">val</span> <span class="n">received</span><span class="p">:</span> <span class="n">NameAndMessage</span> <span class="o">=</span> <span class="n">body</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span><span class="o">.</span><span class="k">with</span><span class="p">(</span><span class="n">body</span> <span class="n">of</span> <span class="n">received</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">spec</span> <span class="n">to</span> <span class="n">echo</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">use</span> <span class="n">another</span> <span class="n">Lens</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">up</span> <span class="n">the</span> <span class="n">API</span><span class="o">-</span><span class="n">key</span> <span class="o">-</span> <span class="n">the</span> <span class="n">answer</span> <span class="ow">is</span> <span class="mi">42</span><span class="err">!</span>
<span class="n">val</span> <span class="n">mySecurity</span> <span class="o">=</span> <span class="n">ApiKeySecurity</span><span class="p">(</span><span class="n">Query</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">required</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">),</span> <span class="p">{</span> <span class="n">it</span> <span class="o">==</span> <span class="mi">42</span> <span class="p">})</span>

<span class="o">//</span> <span class="n">Combine</span> <span class="n">the</span> <span class="n">Routes</span> <span class="n">into</span> <span class="n">a</span> <span class="n">contract</span> <span class="ow">and</span> <span class="n">bind</span> <span class="n">to</span> <span class="n">a</span> <span class="n">context</span><span class="p">,</span> <span class="n">defining</span> <span class="n">a</span> <span class="n">renderer</span> <span class="p">(</span><span class="ow">in</span> <span class="n">this</span> <span class="n">example</span>
<span class="o">//</span> <span class="n">OpenApi</span><span class="o">/</span><span class="n">Swagger</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">security</span> <span class="n">model</span> <span class="p">(</span><span class="ow">in</span> <span class="n">this</span> <span class="n">case</span> <span class="n">an</span> <span class="n">API</span><span class="o">-</span><span class="n">Key</span><span class="p">):</span>
<span class="n">val</span> <span class="n">contract</span> <span class="o">=</span> <span class="n">contract</span> <span class="p">{</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s2">&quot;My great API&quot;</span><span class="p">,</span> <span class="s2">&quot;v1.0&quot;</span><span class="p">),</span> <span class="n">Jackson</span><span class="p">)</span>
    <span class="n">descriptionPath</span> <span class="o">=</span> <span class="s2">&quot;/swagger.json&quot;</span>
    <span class="n">security</span> <span class="o">=</span> <span class="n">mySecurity</span>
    <span class="n">routes</span> <span class="o">+=</span> <span class="n">greetRoute</span><span class="p">()</span>
    <span class="n">routes</span> <span class="o">+=</span> <span class="n">echoRoute</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">val</span> <span class="n">handler</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="n">routes</span><span class="p">(</span><span class="s2">&quot;/api/v1&quot;</span> <span class="n">bind</span> <span class="n">contract</span><span class="p">)</span>

<span class="o">//</span> <span class="n">by</span> <span class="n">default</span><span class="p">,</span> <span class="n">the</span> <span class="n">OpenAPI</span> <span class="n">docs</span> <span class="n">live</span> <span class="n">at</span> <span class="n">the</span> <span class="n">root</span> <span class="n">of</span> <span class="n">the</span> <span class="n">contract</span> <span class="n">context</span><span class="p">,</span> <span class="n">but</span> <span class="n">we</span> <span class="n">can</span> <span class="n">override</span> <span class="n">it</span><span class="o">..</span>
<span class="n">fun</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s2">&quot;/api/v1/swagger.json&quot;</span><span class="p">)))</span>

    <span class="n">println</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="s2">&quot;/api/v1/echo&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="s2">&quot;42&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;{&quot;name&quot;:&quot;Bob&quot;,&quot;message&quot;:&quot;Hello&quot;}&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="p">}</span>
</code></pre></div>


<p>When launched, OpenApi/Swagger format documentation (including JSON schema models) can be found at the route of the module.</p>
<p>For a more extended example, see the following example apps: </p>
<ul>
<li><a href="https://github.com/http4k/http4k-by-example">TDD'd example application</a></li>
<li><a href="https://github.com/http4k/http4k-contract-todo-backend">Todo backend (typesafe contract version)</a></li>
</ul>
<h3 id="naming-of-json-schema-models">Naming of JSON Schema models</h3>
<p>There are currently 2 options for JSON schema generation. </p>
<ol>
<li><em>OpenApi v2 &amp; v3:</em> The standard mechanism can be used with any of the supported http4k JSON modules. It generates 
anonymous JSON schema definition names that are then listed in the <code>schema</code> section of the OpenApi docs.</li>
</ol>
<div class="codehilite"><pre><span></span><code>    <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;1.2&quot;</span><span class="p">,</span> <span class="s">&quot;module description&quot;</span><span class="p">),</span> <span class="n">Argo</span><span class="p">)</span>
</code></pre></div>


<p>... generates definitions like the following in the schema definitions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;schemas&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;object1283926341&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;aString&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<ol>
<li><em>OpenApi v3 only:</em> By including a supported Auto-JSON marshalling module on the classpath (currently only <code>http4k-format-jackson</code>), 
the names of the definitions are generated based on the Kotlin class instances provided to the Contract Route DSL. Note that 
an overloaded OpenApi function automatically provides the default Jackson instance, so we can remove it from the renderer creation:</li>
</ol>
<div class="codehilite"><pre><span></span><code>    <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;1.2&quot;</span><span class="p">,</span> <span class="s">&quot;module description&quot;</span><span class="p">),</span> <span class="n">Jackson</span><span class="p">)</span>
</code></pre></div>


<p>... generates definitions like the following in the schema definitions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;components&quot;</span><span class="p">:{</span>
      <span class="nt">&quot;schemas&quot;</span><span class="p">:{</span>
          <span class="nt">&quot;ArbObject&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;http://foowang&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;example&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://foowang&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&quot;uri&quot;</span>
            <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/index-min.js"></script>

      <script src="../../../assets/javascripts/application.583bbe55.js"></script>





<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125143867-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>


</body>
</html>




<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    
    <meta charset="utf-8">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge">


<meta itemprop="name" content="Testing http4k applications">
<meta name="twitter:title" content="Testing http4k applications">
<meta property="og:title" content="Testing http4k applications" />



<meta name="description" content="How to test http4k endpoints and applications, and modules that support testing">
<meta property="og:description" content="How to test http4k endpoints and applications, and modules that support testing" />
<meta name="twitter:description" content="How to test http4k endpoints and applications, and modules that support testing">



<link rel="canonical" href="https://www.http4k.org/guide/testing/">



<meta name="author" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">
<meta name="twitter:creator" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">




<meta name="lang:clipboard.copy" content="en">

<meta name="lang:clipboard.copied" content="en">

<meta name="lang:search.language" content="en">

<meta name="lang:search.pipeline.stopwords" content="en">

<meta name="lang:search.pipeline.trimmer" content="en">

<meta name="lang:search.result.none" content="en">

<meta name="lang:search.result.one" content="en">

<meta name="lang:search.result.other" content="en">

<meta name="lang:search.tokenizer" content="en">

<!-- ****** faviconit.com favicons ****** -->
<link rel="shortcut icon" href="/img/favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
<link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<link rel="apple-touch-icon" href="/img/favicon-57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/img/favicon-144.png">
<meta name="msapplication-config" content="/img/browserconfig.xml">
<!-- ****** faviconit.com favicons ****** -->
<meta name="generator" content="mkdocs-1.1.2, mkdocs-material-3.0.4">
    
    
    
    <title>Testing http4k applications</title>
    
    
    
    
    
    
    <meta name="theme-color" content="#3f51b5">
    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/codehilite.css"/>
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&amp;display=swap" rel="stylesheet"/>
    
    
    <link rel="stylesheet" href="/css/main.css"/>
    
    <link rel="stylesheet" href="../../css/site.css">
    
    
</head>



<body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="blue">







<div class="intro">
    <div class="row no-gutters justify-content-center">
        <div class="aside col-auto">
    <img class="mb-3 sideToggle d-inline-block d-md-none" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
    <a href="/"><div class="logo"><img src="/img/logo-intro.png" width="185" alt="logo" srcset=""/></div></a>
    <ul class="nav flex-column">
        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../documentation/"
               title="Introduction">Introduction</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../rationale/"
               title="Rationale & Concepts">Rationale & Concepts</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../installation/"
               title="Installation">Installation</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../quickstart/"
               title="Getting started">Getting started</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown active show">
            <a class="nav-link dropdown-toggle active"
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="true">Developer Guide</a>
            <div class="dropdown-menu show">
            
            
            
    
        <a class="dropdown-item nav-link dropdown-toggle  "
            data-toggle="dropdown"
            href="#"
            role="button"
            aria-haspopup="true"
            aria-expanded="false"> Modules</a>
        <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../modules/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/aws/"
           title="AWS">AWS</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/core/"
           title="Core">Core</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/json/"
           title="JSON handling">JSON handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/clients/"
           title="HTTP & Websocket clients">HTTP & Websocket clients</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/metrics/"
           title="Metrics">Metrics</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/multipart/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/resilience/"
           title="Resilience">Resilience</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/servers/"
           title="Server backend">Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/serverless/"
           title="Serverless backend">Serverless backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/templating/"
           title="Templating">Templating</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/contracts/"
           title="Typesafe contracts (OpenAPI3)">Typesafe contracts (OpenAPI3)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/oauth/"
           title="OAuth">OAuth</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/cloud_native/"
           title="Cloud native Configuration">Cloud native Configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/jsonrpc/"
           title="JSON RPC">JSON RPC</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/xml/"
           title="XML handling">XML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/yaml/"
           title="YAML handling">YAML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/hamkrest/"
           title="Hamkrest">Hamkrest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/kotest/"
           title="Kotest">Kotest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/approvaltests/"
           title="Approval Testing">Approval Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/webdriver/"
           title="WebDriver">WebDriver</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/chaos/"
           title="Chaos Testing">Chaos Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../modules/servicevirtualisation/"
           title="Service Virtualisaion">Service Virtualisaion</a>
    

            
        </div>
    

            
            
            
    
        <a class="dropdown-item active"
           href="./"
           title="Application Testing">Application Testing</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Tutorials</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/tdding_http4k/"
           title="TDDing http4k">TDDing http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/documenting_apis_with_openapi/"
           title="Documenting http4k apps with OpenApi3">Documenting http4k apps with OpenApi3</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Cookbook</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/"
           title="How to use this guide">How to use this guide</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/server_as_a_function/"
           title="Server as a function">Server as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/client_as_a_function/"
           title="Client as a function">Client as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/container_integration/"
           title="Container integration">Container integration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/simple_routing/"
           title="Simple routing">Simple routing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/service_virtualisation/"
           title="Service Virtualisation with Servirtium">Service Virtualisation with Servirtium</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/nestable_routes/"
           title="Nestable routes">Nestable routes</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/using_templates/"
           title="Templating engines">Templating engines</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/request_context/"
           title="Typesafe RequestContexts">Typesafe RequestContexts</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/typesafe_http_requests_with_lenses/"
           title="Typesafe HTTP requests with lenses">Typesafe HTTP requests with lenses</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/custom_json_marshallers/"
           title="Custom JSON marshallers">Custom JSON marshallers</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/html_forms/"
           title="HTML forms">HTML forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/multipart_forms/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/generating_data_classes/"
           title="Generating data classes for messages">Generating data classes for messages</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/websockets/"
           title="Websockets">Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/typesafe_http_contracts/"
           title="Typesafe HTTP contracts">Typesafe HTTP contracts</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/structured_logging_with_events/"
           title="Structured Logging with Events">Structured Logging with Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/basic_oauth_authorization_server/"
           title="Basic OAuth Server configuration">Basic OAuth Server configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/custom_oauth_provider/"
           title="Custom OAuth Provider configuration">Custom OAuth Provider configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/customised_servers/"
           title="Custom Server (SSL)">Custom Server (SSL)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/principal_lookup/"
           title="Principal lookup">Principal lookup</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/monitoring/"
           title="Monitoring http4k">Monitoring http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/record_and_replay/"
           title="Recording/replaying HTTP traffic">Recording/replaying HTTP traffic</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../cookbook/test_driven_apps/"
           title="Test driven apps">Test driven apps</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../performance/"
               title="Performance">Performance</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../in_action/"
               title="In action">In action</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Blog</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../blog/meet_http4k/"
           title="Meet http4k">Meet http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../blog/typesafe_websockets/"
           title="Typesafe Websockets">Typesafe Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../blog/retrospective_v3/"
           title="Retrospective on v3">Retrospective on v3</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../support/"
               title="Getting Support">Getting Support</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../contributing/"
               title="Contribute/Support http4k">Contribute/Support http4k</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../code-of-conduct/"
               title="Code of Conduct">Code of Conduct</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../api/"
               title="API docs">API docs</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../changelog/"
               title="Changelog">Changelog</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../faq/"
               title="FAQ">FAQ</a>
        </li>
    

        
    </ul>
</div>
        <main class="col">
            <div class="container">
                <div class="content">
                    <img class="mb-3 sideToggle" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
                    
                    
                    <h1>Application Testing</h1>
                    
                    <p>The creators of <a href="https://http4k.org">http4k</a> takes testing very seriously - so seriously that there really isn't that much to say here! 
The API has been designed to make it as simple as possible to test both individual endpoints and entire applications in a consistent fashion, which is aided by remembering that:</p>
<ol>
<li>The input and output <code>Request/Response</code> objects are immutable.</li>
<li><code>HttpHandlers</code> are just functions.</li>
<li>An entire <a href="https://http4k.org">http4k</a> application is <em>just</em> an <code>HttpHandler</code>.</li>
</ol>
<p>Because of the above, there really isn't much required in the way of "testing infrastructure" - no magic containers or test fixtures that you might find in other frameworks. 
Testing is just matter of calling the correct function! Additionally, because the server and client HttpHandler interfaces are symmetrical - moving between in and out of container contexts 
(or indeed even to another HTTP framework entirely) is just a matter of switching out the HttpHandler implementation from the constructed app (out of container) to an HTTP client (in-container).</p>
<p>That said, possibly the most useful thing is to demonstrate the process that we have developed to test micro-services. A simple example of the development process can be found 
<a href="/tutorials/tdding_http4k">here</a>.</p>
<h2 id="testing-modules">Testing modules</h2>
<p>We have developed the following modules to help with testing:</p>
<ul>
<li><a href="/guide/modules/hamkrest">http4k-testing-hamkrest</a>: a set of composable Hamkrest matchers for matching <a href="https://http4k.org">http4k</a> message objects against.</li>
<li><a href="/guide/modules/webdriver">http4k-testing-webdriver</a>: an ultra-lightweight Selenium WebDriver implementation which can be used to test-drive <a href="https://http4k.org">http4k</a> apps (ie. HttpHandlers).</li>
<li><a href="/guide/modules/approvaltests">http4k-testing-approval</a>: JUnit 5 extensions for <a href="http://approvaltests.com/">Approval testing</a> of <a href="https://http4k.org">http4k</a> Request and Response messages.</li>
<li><a href="/guide/modules/chaos">http4k-testing-chaos</a>: API for declaring and injecting failure modes into <a href="https://http4k.org">http4k</a> applications, allowing modelling and hence answering of "what if" style questions to help understand how code fares under failure conditions such as latency and dying processes.</li>
</ul>
<h2 id="example-code-for-testing">Example code for testing</h2>
<h4 id="testing-httphandlers-with-static-paths">Testing HttpHandlers with static paths <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/testing/StaticPathTest.kt"><img class="octocat"/></a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">package</span> <span class="nn">guide.testing</span>

<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.and</span>
<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.assertion.assertThat</span>

<span class="k">import</span> <span class="nn">org.http4k.core.HttpHandler</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Response</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Status.Companion.OK</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasBody</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasStatus</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>

<span class="k">val</span> <span class="py">EchoBody</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">r</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">bodyString</span><span class="p">())</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">StaticPathTest</span> <span class="p">{</span>
    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">`echoes body from request`</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/anything&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;my data is large&quot;</span><span class="p">)</span>
        <span class="k">val</span> <span class="py">response</span><span class="p">:</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">EchoBody</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/anything&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;my data is large&quot;</span><span class="p">))</span>

        <span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">hasStatus</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">and</span><span class="p">(</span><span class="n">hasBody</span><span class="p">(</span><span class="s">&quot;my data is large&quot;</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="testing-httphandlers-with-dynamic-paths">Testing HttpHandlers with dynamic paths <a href="https://github.com/http4k/http4k/blob/master/src/docsguide/testing/DynamicPathTest.kt"><img class="octocat"/></a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">package</span> <span class="nn">guide.testing</span>

<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.and</span>
<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.assertion.assertThat</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Response</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Status.Companion.OK</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasBody</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasStatus</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.RoutingHttpHandler</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.bind</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.path</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.routes</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>

<span class="k">val</span> <span class="py">EchoPath</span> <span class="p">=</span> <span class="s">&quot;/echo/{message}&quot;</span> <span class="n">bind</span> <span class="n">GET</span> <span class="n">to</span> <span class="p">{</span> <span class="n">r</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">)</span> <span class="o">?:</span> <span class="s">&quot;nothing!&quot;</span><span class="p">)</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">DynamicPathTest</span> <span class="p">{</span>

    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">`echoes body from path`</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">route</span><span class="p">:</span> <span class="n">RoutingHttpHandler</span> <span class="p">=</span> <span class="n">routes</span><span class="p">(</span><span class="n">EchoPath</span><span class="p">)</span>
        <span class="k">val</span> <span class="py">response</span><span class="p">:</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">route</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/echo/my+great+message&quot;</span><span class="p">))</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">hasStatus</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">and</span><span class="p">(</span><span class="n">hasBody</span><span class="p">(</span><span class="s">&quot;my great message&quot;</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="testing-filters">Testing Filters <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/testing/FilterTest.kt"><img class="octocat"/></a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">package</span> <span class="nn">guide.testing</span>

<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.and</span>
<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.assertion.assertThat</span>

<span class="k">import</span> <span class="nn">org.http4k.core.Filter</span>
<span class="k">import</span> <span class="nn">org.http4k.core.HttpHandler</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Response</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Status.Companion.OK</span>
<span class="k">import</span> <span class="nn">org.http4k.core.then</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasHeader</span>
<span class="k">import</span> <span class="nn">org.http4k.hamkrest.hasStatus</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>

<span class="k">val</span> <span class="py">AddLatency</span> <span class="p">=</span> <span class="n">Filter</span> <span class="p">{</span> <span class="n">next</span> <span class="p">-&gt;</span>
    <span class="p">{</span>
        <span class="n">next</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;x-extra-header&quot;</span><span class="p">,</span> <span class="s">&quot;some value&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">FilterTest</span> <span class="p">{</span>
    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">`adds a special header`</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">handler</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">AddLatency</span><span class="p">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">val</span> <span class="py">response</span><span class="p">:</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/echo/my+great+message&quot;</span><span class="p">))</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">hasStatus</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">and</span><span class="p">(</span><span class="n">hasHeader</span><span class="p">(</span><span class="s">&quot;x-extra-header&quot;</span><span class="p">,</span> <span class="s">&quot;some value&quot;</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="testing-websockets-with-offline-and-online-clients">Testing Websockets with offline and online clients <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/testing/TestingWebsockets.kt"><img class="octocat"/></a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">package</span> <span class="nn">guide.testing</span>

<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.assertion.assertThat</span>
<span class="k">import</span> <span class="nn">com.natpryce.hamkrest.equalTo</span>

<span class="k">import</span> <span class="nn">org.http4k.client.WebsocketClient</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Uri</span>
<span class="k">import</span> <span class="nn">org.http4k.lens.Path</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.bind</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.websockets</span>
<span class="k">import</span> <span class="nn">org.http4k.server.Jetty</span>
<span class="k">import</span> <span class="nn">org.http4k.server.asServer</span>
<span class="k">import</span> <span class="nn">org.http4k.testing.testWsClient</span>
<span class="k">import</span> <span class="nn">org.http4k.websocket.Websocket</span>
<span class="k">import</span> <span class="nn">org.http4k.websocket.WsClient</span>
<span class="k">import</span> <span class="nn">org.http4k.websocket.WsHandler</span>
<span class="k">import</span> <span class="nn">org.http4k.websocket.WsMessage</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.AfterEach</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.BeforeEach</span>
<span class="k">import</span> <span class="nn">org.junit.jupiter.api.Test</span>

<span class="k">val</span> <span class="py">namePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>

<span class="c1">// here is our websocket app - it uses dynamic path binding and lenses</span>
<span class="k">val</span> <span class="py">testApp</span><span class="p">:</span> <span class="n">WsHandler</span> <span class="p">=</span> <span class="n">websockets</span><span class="p">(</span>
    <span class="s">&quot;/{name}&quot;</span> <span class="n">bind</span> <span class="p">{</span> <span class="n">ws</span><span class="p">:</span> <span class="n">Websocket</span> <span class="p">-&gt;</span>
        <span class="k">val</span> <span class="py">name</span> <span class="p">=</span> <span class="n">namePath</span><span class="p">(</span><span class="n">ws</span><span class="p">.</span><span class="n">upgradeRequest</span><span class="p">)</span>
        <span class="n">ws</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">WsMessage</span><span class="p">(</span><span class="s">&quot;hello $name&quot;</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">// this is the abstract contract that defines the behaviour to be tested</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">WebsocketContract</span> <span class="p">{</span>
    <span class="c1">// subclasses only have to supply a blocking WsClient</span>
    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">client</span><span class="p">():</span> <span class="n">WsClient</span>

    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">`echoes back connected name`</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">client</span><span class="p">().</span><span class="n">received</span><span class="p">().</span><span class="n">take</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">toList</span><span class="p">(),</span> <span class="n">equalTo</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="n">WsMessage</span><span class="p">(</span><span class="s">&quot;hello bob&quot;</span><span class="p">))))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// a unit test version of the contract - it connects to the websocket in memory with no network</span>
<span class="k">class</span> <span class="nc">WebsocketUnitTest</span> <span class="p">:</span> <span class="n">WebsocketContract</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">client</span><span class="p">()</span> <span class="p">=</span> <span class="n">cookbook</span><span class="p">.</span><span class="n">websockets</span><span class="p">.</span><span class="n">testApp</span><span class="p">.</span><span class="n">testWsClient</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/bob&quot;</span><span class="p">))</span><span class="o">!!</span>
<span class="p">}</span>

<span class="c1">// a integration test version of the contract - it starts a server and connects to the websocket over the network</span>
<span class="k">class</span> <span class="nc">WebsocketServerTest</span> <span class="p">:</span> <span class="n">WebsocketContract</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">client</span><span class="p">()</span> <span class="p">=</span> <span class="n">WebsocketClient</span><span class="p">.</span><span class="n">blocking</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;ws://localhost:8000/bob&quot;</span><span class="p">))</span>

    <span class="k">private</span> <span class="k">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">cookbook</span><span class="p">.</span><span class="n">websockets</span><span class="p">.</span><span class="n">testApp</span><span class="p">.</span><span class="n">asServer</span><span class="p">(</span><span class="n">Jetty</span><span class="p">(</span><span class="m">8000</span><span class="p">))</span>

    <span class="n">@BeforeEach</span>
    <span class="k">fun</span> <span class="nf">before</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">@AfterEach</span>
    <span class="k">fun</span> <span class="nf">after</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">server</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/index-min.js"></script>

      <script src="../../assets/javascripts/application.583bbe55.js"></script>





<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125143867-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>


</body>
</html>
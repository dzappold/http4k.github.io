



<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    
    <script language="JavaScript">
  ak = "Y2JjZDg5MzE5YTUwYjYzMTYyNzFmNGMzZDc5OWM2NTc="
</script>
    <meta charset="utf-8">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge">


<meta itemprop="name" content="http4k How-to: Make JSON Faster">
<meta name="twitter:title" content="http4k How-to: Make JSON Faster">
<meta property="og:title" content="http4k How-to: Make JSON Faster" />



<meta name="description" content="Recipes to make JSON faster through the use of lighter reflection or code generation">
<meta property="og:description" content="Recipes to make JSON faster through the use of lighter reflection or code generation" />
<meta name="twitter:description" content="Recipes to make JSON faster through the use of lighter reflection or code generation">



<link rel="canonical" href="https://www.http4k.org/guide/howto/make_json_faster/">



<meta name="author" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">
<meta name="twitter:creator" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">




<meta name="lang:clipboard.copy" content="en">

<meta name="lang:clipboard.copied" content="en">

<meta name="lang:search.language" content="en">

<meta name="lang:search.pipeline.stopwords" content="en">

<meta name="lang:search.pipeline.trimmer" content="en">

<meta name="lang:search.result.none" content="en">

<meta name="lang:search.result.one" content="en">

<meta name="lang:search.result.other" content="en">

<meta name="lang:search.tokenizer" content="en">

<!-- ****** faviconit.com favicons ****** -->
<link rel="shortcut icon" href="/img/favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
<link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<link rel="apple-touch-icon" href="/img/favicon-57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/img/favicon-144.png">
<meta name="msapplication-config" content="/img/browserconfig.xml">
<!-- ****** faviconit.com favicons ****** -->
<meta name="generator" content="mkdocs-1.2.3, mkdocs-material-3.0.4">
    
    
    
    <title>http4k How-to: Make JSON Faster</title>
    
    
    
    
    
    
    <meta name="theme-color" content="#4051b5">
    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/codehilite.css"/>
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&amp;display=swap" rel="stylesheet"/>
    
    
    <link rel="stylesheet" href="/css/main.css"/>
    
    <link rel="stylesheet" href="../../../css/site.css">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>



<body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="blue">







<div class="intro">
    <div class="row no-gutters justify-content-center">
        <div class="aside col-auto">
    <img class="mb-3 sideToggle d-inline-block d-md-none" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
    <a href="/">
        <div class="logo"><img src="/img/logo-intro.png" width="185" alt="logo" srcset=""/></div>
    </a>
    <ul class="nav flex-column">
        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../documentation/"
               title="Introduction">Introduction</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../quickstart/"
               title="Quickstart">Quickstart</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../"
               title="About the docs">About the docs</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Concepts</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/rationale/"
           title="Rationale">Rationale</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/http/"
           title="HTTP">HTTP</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/serverless/"
           title="Serverless">Serverless</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/websockets/"
           title="WebSockets">WebSockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/server-sent-events/"
           title="Server-Sent Events">Server-Sent Events</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Tutorials</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/your_first_http4k_app/"
           title="Your first http4k app">Your first http4k app</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/serverless_http4k_with_aws_lambda/"
           title="Deploying an http4k app to AWS Lambda">Deploying an http4k app to AWS Lambda</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/going_native_with_graal_on_aws_lambda/"
           title="Going native with Graal on AWS Lambda">Going native with Graal on AWS Lambda</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/tdding_http4k/"
           title="TDDing http4k">TDDing http4k</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown active show">
            <a class="nav-link dropdown-toggle active"
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="true">How-to guides</a>
            <div class="dropdown-menu show">
            
            
            
    
        <a class="dropdown-item "
           href="../"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../server_as_a_function/"
           title="Basic: Server as a function">Basic: Server as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../client_as_a_function/"
           title="Basic: Client as a function">Basic: Client as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_a_server_backend/"
           title="Basic: Use a Server backend">Basic: Use a Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../write_different_test_types/"
           title="Basic: Different test-types">Basic: Different test-types</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../simple_routing/"
           title="Basic: Simple routing">Basic: Simple routing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../nestable_routes/"
           title="Basic: Nestable routes">Basic: Nestable routes</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../attach_context_to_a_request/"
           title="Attach context to a request">Attach context to a request</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../configure_an_oauth_server/"
           title="Configure an OAuth Server">Configure an OAuth Server</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../create_a_custom_json_marshaller/"
           title="Create a custom JSON marshaller">Create a custom JSON marshaller</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../customise_a_server_backend/"
           title="Customise a Server backend">Customise a Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../deploy_webjars/"
           title="Deploy WebJars">Deploy WebJars</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../integrate_with_openapi/"
           title="Integrate with OpenAPI">Integrate with OpenAPI</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../leverage_graphql/"
           title="Leverage GraphQL">Leverage GraphQL</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../lookup_a_user_principal/"
           title="Lookup a User Principal">Lookup a User Principal</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../monitor_http4k/"
           title="Monitor http4k">Monitor http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../record_and_replay_http_traffic/"
           title="Record & replay HTTP traffic">Record & replay HTTP traffic</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../serve_sse/"
           title="Serve Server-Sent Events">Serve Server-Sent Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../serve_websockets/"
           title="Serve Websockets">Serve Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../structure_your_logs_with_events/"
           title="Structure your logs with Events">Structure your logs with Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../test_using_service_virtualisation/"
           title="Test using Service Virtualisation">Test using Service Virtualisation</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../typesafe_your_api_with_lenses/"
           title="Typesafe your API with lenses">Typesafe your API with lenses</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../secure_and_auth_http/"
           title="Secure and auth HTTP services">Secure and auth HTTP services</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_a_custom_oauth_provider/"
           title="Use a custom OAuth Provider">Use a custom OAuth Provider</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_a_templating_engine/"
           title="Use a templating engine">Use a templating engine</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_html_forms/"
           title="Use HTML forms">Use HTML forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_multipart_forms/"
           title="Use Multipart forms">Use Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../self_document_systems_with_tests/"
           title="Self document systems with tests">Self document systems with tests</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../use_auto_content_negotiation/"
           title="Use Auto Content Negotiation">Use Auto Content Negotiation</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../create_a_swagger_ui/"
           title="Redoc and Swagger UI">Redoc and Swagger UI</a>
    

            
            
            
    
        <a class="dropdown-item active"
           href="./"
           title="Make JSON Faster">Make JSON Faster</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../make_parallel_calls/"
           title="Make parallel HTTP calls">Make parallel HTTP calls</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Reference</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../reference/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/core/"
           title="Core">Core</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/servers/"
           title="Server backend">Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/serverless/"
           title="Serverless backend">Serverless backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/clients/"
           title="HTTP & Websocket clients">HTTP & Websocket clients</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/contracts/"
           title="Typesafe contracts (OpenAPI3)">Typesafe contracts (OpenAPI3)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/json/"
           title="JSON handling">JSON handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/templating/"
           title="Templating">Templating</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/multipart/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/cloud_native/"
           title="Cloud Native Configuration">Cloud Native Configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/cloud_events/"
           title="Cloud Events">Cloud Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/micrometer/"
           title="Micrometer">Micrometer</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/opentelemetry/"
           title="OpenTelemetry">OpenTelemetry</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/resilience4j/"
           title="Resilience4J">Resilience4J</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/failsafe/"
           title="Failsafe">Failsafe</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/aws/"
           title="AWS">AWS</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/oauth/"
           title="OAuth">OAuth</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/digest/"
           title="Digest">Digest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/graphql/"
           title="GraphQL">GraphQL</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/htmx/"
           title="htmx">htmx</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/webhooks/"
           title="Webhooks">Webhooks</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/jsonrpc/"
           title="JSON RPC">JSON RPC</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/xml/"
           title="XML handling">XML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/yaml/"
           title="YAML handling">YAML handling</a>
    

            
            
            
    
        <a class="dropdown-item nav-link dropdown-toggle  "
            data-toggle="dropdown"
            href="#"
            role="button"
            aria-haspopup="true"
            aria-expanded="false"> Testing</a>
        <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../reference/testing/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/approvaltests/"
           title="Approval Testing">Approval Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/chaos/"
           title="Chaos Testing">Chaos Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/hamkrest/"
           title="Hamkrest">Hamkrest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/kotest/"
           title="Kotest">Kotest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/servicevirtualisation/"
           title="Service Virtualisation">Service Virtualisation</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/strikt/"
           title="Strikt">Strikt</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/tracerbullet/"
           title="Tracer Bullet">Tracer Bullet</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../reference/webdriver/"
           title="WebDriver">WebDriver</a>
    

            
        </div>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Blog</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/meet_http4k/"
           title="Meet http4k">Meet http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/typesafe_websockets/"
           title="Typesafe Websockets">Typesafe Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/typesafe_configuration/"
           title="Typesafe 12-factor config">Typesafe 12-factor config</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/documenting_apis_with_openapi/"
           title="Documenting http4k apps with OpenApi3">Documenting http4k apps with OpenApi3</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/retrospective_v3/"
           title="Retrospective on v3">Retrospective on v3</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/nanoservices/"
           title="Nanoservices">Nanoservices</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/toolbox/"
           title="Toolbox: Guns for show, knives for a pro">Toolbox: Guns for show, knives for a pro</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/http4k_v4/"
           title="http4k v4 - 17 platforms and counting...">http4k v4 - 17 platforms and counting...</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/http4k_v5/"
           title="http4k Platform v5 - New Servers, Loom, TracerBullet, OpenAI plugin SDK and more">http4k Platform v5 - New Servers, Loom, TracerBullet, OpenAI plugin SDK and more</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/regarding_jcenter/"
           title="JCenter Shutdown">JCenter Shutdown</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../changelog/"
               title="Changelog">Changelog</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../in_action/"
               title="http4k in action">http4k in action</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../performance/"
               title="Performance">Performance</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../faq/"
               title="FAQ">FAQ</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../support/"
               title="Getting support">Getting support</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../contributing/"
               title="Contribute/support http4k">Contribute/support http4k</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../code-of-conduct/"
               title="Code of Conduct">Code of Conduct</a>
        </li>
    

        
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/http4k/http4k">
                <img src="/img/GitHub-Mark-black.png" width="28" alt="See source on GitHub">&nbsp;&nbsp;Source Code</a>
        </li>
    </ul>
</div>
        <main class="col">
          <div class="container">
                <div class="searchBox">
                  <img class="searchBoxIcon" src="/img/search-icon.svg" width="20" alt="" srcset=""/>
                  <input id="search" type="text" placeholder="Ctrl/⌘ K"/>
                </div>
                <div class="content">
                    <img class="mb-3 sideToggle" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
                    
                    
                    <h1>Make JSON Faster</h1>
                    
                    <p>The standard JSON format modules included in Http4k (like Jackson and Moshi) are good enough for most applications.
However there are scenarios where you may want to further optimize them for runtime performance,
or to achieve acceptable cold start times in serverless deployments.</p>
<h2 id="kotlinxserialization">kotlinx.serialization<a class="headerlink" href="#kotlinxserialization" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/Kotlin/kotlinx.serialization">kotlinx.serialization</a> is a relatively simple and effective option.
It's fully supported by Http4k, but we'll go over it first as a baseline to compare against the others.
It generates the serialization adapters at compile time, which means it doesn't need reflection during runtime.</p>
<p>kotlinx.serialization is a very fast and efficient module, but there are some caveats to consider:</p>
<ol>
<li>No support for many builtin JVM types (e.g. java.time, UUID)</li>
<li>Custom serializers must be registered via annotation</li>
<li>No support for values4k classes</li>
</ol>
<h3 id="gradle">Gradle<a class="headerlink" href="#gradle" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">kotlin</span><span class="p">(</span><span class="s">&quot;plugin.serialization&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;1.9.22&quot;</span>
<span class="p">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="s">&quot;org.http4k:http4k-bom:5.19.0.0&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.http4k:http4k-format-kotlinx-serialization&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="example">Example <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/howto/make_json_faster/kotlinx_example.kt"><img class="octocat"/></a><a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">guide.howto.make_json_faster</span>

<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.Serializable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Method</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Request</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.with</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.KotlinxSerialization</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.UUID</span>

<span class="c1">// You must annotate your class to generate the adapter</span>
<span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">KotlinXCat</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="c1">// UUID not supported</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>

<span class="c1">// use the builtin http4k module</span>
<span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KotlinxSerialization</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KotlinXCat</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Kratos&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// serialize</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">asFormatString</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// deserialize</span>
<span class="w">    </span><span class="n">json</span><span class="p">.</span><span class="na">asA</span><span class="o">&lt;</span><span class="n">KotlinXCat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// make a lens</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">autoBody</span><span class="o">&lt;</span><span class="n">KotlinXCat</span><span class="o">&gt;</span><span class="p">().</span><span class="na">toLens</span><span class="p">()</span>
<span class="w">    </span><span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">lens</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">cat</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="moshi_metadata_reflect">Moshi Metadata Reflect<a class="headerlink" href="#moshi_metadata_reflect" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/ZacSweers/MoshiX/tree/main/moshi-metadata-reflect">moshi-metadata-reflect</a> is a plugin for Moshi that replaces the heavyweight <code>kotlin-reflect</code> with the lighter <code>kotlinx-metadata-jvm</code>.
While this module still uses reflection, eliminating <code>kotlin-reflect</code> from your classpath will reduce your binary size by several MB and make a respectable improvement in cold start time.</p>
<p>Moshi Metadata Reflect is very simple, and doesn't require any gradle plugins or finicky code generation.
However, it will bring the smallest performance benefit out of these options.</p>
<h3 id="gradle_1">Gradle<a class="headerlink" href="#gradle_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="s">&quot;org.http4k:http4k-bom:5.19.0.0&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.http4k:http4k-format-moshi&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kotlin-reflect&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Exclude kotlin-reflect</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;dev.zacsweers.moshix:moshi-metadata-reflect:0.23.0&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="example_1">Example <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/howto/make_json_faster/moshi_metadata_reflect_example.kt"><img class="octocat"/></a><a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">guide.howto.make_json_faster</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.squareup.moshi.Moshi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">dev.zacsweers.moshix.reflect.MetadataKotlinJsonAdapterFactory</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Method</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Request</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.with</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ConfigurableMoshi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.EventAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ListAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.MapAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ThrowableAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.asConfigurable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.withStandardMappings</span>
<span class="k">import</span><span class="w"> </span><span class="nn">se.ansman.kotshi.JsonSerializable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.UUID</span>

<span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConfigurableMoshi</span><span class="p">(</span>
<span class="w">    </span><span class="n">Moshi</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">EventAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">ThrowableAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">ListAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">MapAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">asConfigurable</span><span class="p">(</span><span class="n">MetadataKotlinJsonAdapterFactory</span><span class="p">())</span><span class="w"> </span><span class="c1">// &lt;-- moshi-metadata-reflect</span>
<span class="w">        </span><span class="p">.</span><span class="na">withStandardMappings</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">done</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MoshiCat</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MoshiCat</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Kratos&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// serialize</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">asFormatString</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// deserialize</span>
<span class="w">    </span><span class="n">json</span><span class="p">.</span><span class="na">asA</span><span class="o">&lt;</span><span class="n">MoshiCat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// make a lens</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">autoBody</span><span class="o">&lt;</span><span class="n">MoshiCat</span><span class="o">&gt;</span><span class="p">().</span><span class="na">toLens</span><span class="p">()</span>
<span class="w">    </span><span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">lens</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">cat</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="kotshi">Kotshi<a class="headerlink" href="#kotshi" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/ansman/kotshi">Kotshi</a> is a plugin for Moshi.  It's very similar to <a href="https://github.com/square/moshi/tree/master/moshi-kotlin-codegen">moshi-kotlin-codegen</a>
in that they both generate Moshi adapters at compile time.
However, since <code>moshi-kotlin-codegen</code> still requires <code>kotlin-reflect</code> at runtime, <code>kotshi</code> can bring much greater cold start performance gains.</p>
<p>Kotshi is a very fast and efficient module, but is the most difficult to set up.
It requires a gradle plugin, several dependencies, and depends on code that only exists after compile.</p>
<h3 id="gradle_2">Gradle<a class="headerlink" href="#gradle_2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// The KSP plugin is required to generate the adapters at compile time</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;1.9.22-1.0.16&quot;</span>
<span class="p">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.http4k:http4k-format-moshi&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kotlin-reflect&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Exclude kotlin-reflect</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get the Kotshi runtime library and configure KSP to generate the adapters</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;se.ansman.kotshi:api:2.15.0&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ksp</span><span class="p">(</span><span class="s">&quot;se.ansman.kotshi:compiler:2.15.0&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="example_2">Example <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/howto/make_json_faster/kotshi_example.kt"><img class="octocat"/></a><a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">guide.howto.make_json_faster</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.squareup.moshi.JsonAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.squareup.moshi.Moshi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Method</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.Request</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.core.with</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ConfigurableMoshi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.EventAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ListAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.MapAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.ThrowableAdapter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.asConfigurable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.http4k.format.withStandardMappings</span>
<span class="k">import</span><span class="w"> </span><span class="nn">se.ansman.kotshi.JsonSerializable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">se.ansman.kotshi.KotshiJsonAdapterFactory</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.UUID</span>

<span class="c1">// Annotation is required to generate the adapter</span>
<span class="nd">@JsonSerializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">KotshiCat</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="c1">// Build the kotshi adapter</span>
<span class="nd">@KotshiJsonAdapterFactory</span>
<span class="kd">private</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="nc">ExampleJsonAdapterFactory</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">JsonAdapter</span><span class="p">.</span><span class="na">Factory</span><span class="w"> </span><span class="k">by</span>
<span class="w">    </span><span class="n">KotshiExampleJsonAdapterFactory</span><span class="w"> </span><span class="c1">// this class will be generated during compile</span>

<span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConfigurableMoshi</span><span class="p">(</span>
<span class="w">    </span><span class="n">Moshi</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ExampleJsonAdapterFactory</span><span class="p">)</span><span class="w"> </span><span class="c1">// inject kotshi here</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">EventAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">ThrowableAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">ListAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="n">MapAdapter</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">asConfigurable</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">withStandardMappings</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">done</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KotshiCat</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Kratos&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// serialize</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">asFormatString</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// deserialize</span>
<span class="w">    </span><span class="n">json</span><span class="p">.</span><span class="na">asA</span><span class="o">&lt;</span><span class="n">KotshiCat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">also</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// make a lens</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">autoBody</span><span class="o">&lt;</span><span class="n">KotshiCat</span><span class="o">&gt;</span><span class="p">().</span><span class="na">toLens</span><span class="p">()</span>
<span class="w">    </span><span class="n">Request</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">lens</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">cat</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/index-min.js"></script>
<script src="/js/toggle-search.js"></script>

      <script src="../../../assets/javascripts/application.583bbe55.js"></script>









<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-125143867-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
  apiKey: atob(ak),
  indexName: 'http4k',
  inputSelector: '#search',
  debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>